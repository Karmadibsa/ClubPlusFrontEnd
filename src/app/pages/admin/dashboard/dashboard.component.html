  <!-- En-tête -->
  <div class="header">
    <h1>Dashboard</h1>
    @if (isLoading){
      <div class="loading-indicator" role="status" aria-live="polite">Chargement des données...</div>
    }
  </div>

  <!-- Section Statistiques -->
  <section class="stats-grid" aria-labelledby="stats-title">
    <h2 id="stats-title" class="visually-hidden">Statistiques Clés</h2>
    <!-- Boucle sur un array de stats serait mieux, mais on garde la structure demandée -->
    <app-stat-card title="Événements organisés" [value]="totalEvents"></app-stat-card>
    <app-stat-card title="Événements à venir" [value]="upcomingEventsCount"></app-stat-card>
    <app-stat-card title="Taux de participation" [value]="averageEventOccupancy | percent:'1.0-1'"></app-stat-card>
    <app-stat-card title="Membres Actifs" [value]="totalActiveMembers"></app-stat-card>
    <app-stat-card title="Réservations validées" [value]="totalParticipations"></app-stat-card>
  </section>

  <!-- Section Graphiques -->
  <section class="charts-grid" aria-labelledby="charts-title">
    <h2 id="charts-title" class="visually-hidden">Graphiques</h2>

    <!-- Graphique Inscriptions -->
    <!-- On garde les styles inline pour l'instant car ils semblent critiques -->
    <div class="card chart-container stat-card" style="position: relative; height:400px; display: block;">
      <h3>Évolution des Inscriptions</h3>
      @if (membersChartData.datasets.length > 0 && !isLoading) {
        <canvas baseChart
                [data]="membersChartData"
                [options]="membersChartOptions"
                type="line"
                role="img"
                aria-label="Graphique linéaire: Évolution des inscriptions">
        </canvas>
      } @else if (!isLoading) {
        <div class="chart-placeholder">Aucune donnée d'inscription.</div>
      }
    </div>

    <!-- Graphique Notes -->
    <!-- On garde les styles inline pour l'instant -->
    <div class="card chart-container stat-card" style="position: relative; height:400px; display: block;">
      <h3>Notes Moyennes</h3>
      @if (ratingsChartData.datasets.length > 0 && !isLoading) {
        <canvas baseChart
                [data]="ratingsChartData"
                [options]="ratingsChartOptions"
                type="bar"
                role="img"
                aria-label="Graphique en barres: Notes moyennes">
        </canvas>
      } @else if (!isLoading) {
        <div class="chart-placeholder">Aucune donnée de notes.</div>
      }
    </div>
  </section>

  <!-- Section Tableaux -->
  <section class="tables-grid" aria-labelledby="tables-title">
    <h2 id="tables-title" class="visually-hidden">Données détaillées</h2>

    <!-- Tableau Membres -->
    <div class="table-container card"> <!-- Ajout classe card pour cohérence ombre/bordure -->
      <h3>Derniers membres inscrits</h3>
      <div class="table-wrapper"> <!-- Ajout du wrapper pour scroll -->
        <table class="full-width-table data-table" aria-describedby="members-table-title">
          <caption id="members-table-title" class="visually-hidden">5 derniers membres inscrits</caption>
          <thead>
          <tr>
            <th>ID</th>
            <th>Nom Prénom</th>
            <th>Naissance</th>
            <th>Ville</th>
            <th>Téléphone</th>
            <th>Email</th>
            <th>Rôle</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
            @for (member of lastFiveMembers; track member.id) {
              <tr app-membre-row [membre]="member" (roleChangeRequested)="handleSaveRole($event)"></tr>
            } @empty {
              <tr><td colspan="8" class="empty-table-message">Aucun membre récent.</td></tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <!-- Tableau Événements -->
    <div class="table-container card"> <!-- Ajout classe card -->
      <div class="header-event"> <!-- Renommé pour clarté, contient titre + bouton -->
        <h3>Prochains événements</h3>
        <app-create-event-button (createClicked)="openCreateEventModal()"></app-create-event-button>
      </div>
      <div class="table-wrapper"> <!-- Ajout du wrapper pour scroll -->
        <table class="full-width-table data-table" aria-describedby="events-table-title">
          <caption id="events-table-title" class="visually-hidden">5 prochains événements</caption>
          <thead>
          <tr>
            <th>ID</th>
            <th>Titre</th>
            <th>Début - Fin</th>
            <th>Description</th>
            <th>Participants</th>
            <th>Lieu</th>
            <th>Catégories</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
            @for (event of nextFiveEvents; track event.id) {
              <tr app-event-row [evenement]="event" (modifier)="handleOpenEditModal($event)" (deleteRequest)="handleDeleteEventRequest($event)"></tr>
            } @empty {
              <tr><td colspan="8" class="empty-table-message">Aucun événement à venir.</td></tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </section>
<!-- Modale d'édition (hors du flux principal) -->
@if (isEditEventModalVisible) {
  <app-edit-event
    [isVisible]="isEditEventModalVisible"
    [event]="selectedEventForEditModal"
    (saveSuccess)="handleSaveEventSuccess($event)"
    (close)="handleCloseEditModal()">
  </app-edit-event>
}
