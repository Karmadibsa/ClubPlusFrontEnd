<div class="sidebar">
  <app-sidebar></app-sidebar>
</div>
<div class="container-page">
  <div class="container">
    <div class="header">
      <h1>Vos billets</h1>
    </div>
    <!-- Tableau des réservations -->
    <table>
      <thead>
      <tr>
        <th>Nom</th>
        <th>Date</th>
        <th>Heure</th>
        <th>Nom de l'événement</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <!-- Utilisation du composant reservation-row -->
      <tr app-reservation-row
          *ngFor="let reservation of reservations"
          [reservation]="reservation"
          (openQrModal)="openQrModal($event)"
          (generatePDF)="generatePDF($event)">
      </tr>
      </tbody>
    </table>

    <!-- Zone cachée pour générer les QR codes -->
    <div style="display: none;">
      <div *ngFor="let reservation of reservations">
        <qrcode
          [qrdata]="reservation.qrcodeurl"
          [width]="256"
          [errorCorrectionLevel]="'M'"
          (qrCodeURL)="onChangeURL($event, reservation)"
          id="qr-code-{{reservation.id}}">
        </qrcode>
      </div>
    </div>
  </div>
</div>

<!-- Composant modal pour afficher le QR code -->
<app-qr-code-modal
  [isOpen]="isModalOpen"
  [qrData]="selectedTicket?.qrcodeurl || ''"
  [ticketInfo]="selectedTicket"
  (closeModal)="closeQrModal()">
</app-qr-code-modal>

<!-- Template pour le PDF - initialement caché mais correctement structuré -->
<div id="pdf-content" style="display: none; width: 210mm; padding: 10mm;">
  <div class="pdf-container" *ngIf="selectedTicket">
    <div class="header" style="text-align: center; margin-bottom: 20px;">
      <h1 style="font-size: 24px; color: #333;">Votre billet</h1>
    </div>
    <div class="ticket-info" style="font-size: 14px; line-height: 1.5;">
      <p><strong>Événement:</strong> {{ selectedTicket.event?.title }}</p>
      <p><strong>Date:</strong> {{ selectedTicket.event?.start | date:'dd/MM/yyyy' }}</p>
      <p><strong>Lieu:</strong> {{ selectedTicket.event?.location }}</p>
      <p><strong>Catégorie:</strong> {{ selectedTicket.categorie?.nom }}</p>
      <p><strong>Nom:</strong> {{ selectedTicket.membre?.prenom }} {{ selectedTicket.membre?.nom }}</p>
      <!-- QR code pour le PDF -->
      <div class="qr-code" style="text-align: center; margin-top: 20px;">
        <qrcode
          [qrdata]="selectedTicket.qrcodeurl"
          [width]="200"
          [errorCorrectionLevel]="'M'">
        </qrcode>
      </div>
    </div>
  </div>
</div>

