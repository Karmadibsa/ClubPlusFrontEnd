<div class="sidebar">
  <app-sidebar></app-sidebar>
</div>

  <div class="container">
    <div class="header">
      <h1>Vos billets</h1>
    </div>
    <!-- Tableau des réservations -->
    <table>
      <thead>
      <tr>
        <th>Date</th>
        <th>Heure</th>
        <th>Nom de l'événement</th>
        <th>Categorie</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <!-- Utilisation du composant reservation-row -->
        @for (reservation of reservations ; track reservation.id) {
      <tr app-reservation-row
          [reservation]="reservation"
          (openQrModal)="openQrModal($event)"
          (generatePDF)="generatePDF($event)"
          (deleteReservation)="onCancelReservation($event)">
      </tr>
        }
      </tbody>
    </table>

    <!-- Zone cachée pour générer les QR codes -->
    <div style="display: none;">
      @for ( reservation of reservations; track reservation.id) {
      <div>


        @if (reservation?.qrcodeData) {
          <qrcode
            [qrdata]="reservation.qrcodeData ?? ''"
            [width]="256"
            [errorCorrectionLevel]="'M'"
            (qrCodeURL)="onChangeURL($event, reservation)"
            id="qr-code-{{reservation.id}}">
          </qrcode>
        }
      </div>
      }
    </div>
  </div>


<!-- Composant modal pour afficher le QR code -->
<app-qr-code-modal
  [isOpen]="isModalOpen"
  [qrData]="selectedTicket?.qrcodeData || ''"
  [ticketInfo]="selectedTicket"
  (closeModal)="closeQrModal()">
</app-qr-code-modal>

<!-- Template pour le PDF - initialement caché mais correctement structuré -->
<div id="pdf-content" style="display: none; width: 210mm; padding: 10mm;">
  @if (selectedTicket){
  <div class="pdf-container">
    <div class="header" style="text-align: center; margin-bottom: 20px;">
      <h1 style="font-size: 24px; color: #333;">Votre billet</h1>
    </div>
    <div class="ticket-info" style="font-size: 14px; line-height: 1.5;">
      <p><strong>Événement:</strong> {{ selectedTicket.event?.nom }}</p>
      <p><strong>Date:</strong> {{ selectedTicket.event?.start | date:'dd/MM/yyyy' }}</p>
      <p><strong>Lieu:</strong> {{ selectedTicket.event?.location }}</p>
      <p><strong>Catégorie:</strong> {{ selectedTicket.categorie?.nom }}</p>
      <p><strong>Nom:</strong> {{ selectedTicket.membre?.prenom }} {{ selectedTicket.membre?.nom }}</p>
      <!-- QR code pour le PDF -->
      <div class="qr-code" style="text-align: center; margin-top: 20px;">
        @if (selectedTicket?.qrcodeData) {
          <qrcode
            [qrdata]="selectedTicket?.qrcodeData ?? ''"
            [width]="200"
            [errorCorrectionLevel]="'M'">
          </qrcode>
        }
      </div>
    </div>
  </div>
  }
</div>

